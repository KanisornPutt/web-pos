{"ast":null,"code":"import axios from \"axios\";\nimport { onMounted, ref } from \"vue\";\nimport { useRouter } from \"vue-router\";\nimport { useStore } from \"vuex\";\nexport default {\n  setup() {\n    const email = ref(\"\");\n    const router = useRouter();\n    const store = useStore();\n    const getAccessToken = async code => {\n      try {\n        const response = await axios.post(\"https://oauth2.googleapis.com/token\", {\n          code: code,\n          client_id: \"38181892421-dcmv3r9nvnkbalt85nskg16qtlc8e7n5.apps.googleusercontent.com\",\n          client_secret: \"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\",\n          redirect_uri: \"http://localhost:8020/redirect\",\n          grant_type: \"authorization_code\"\n        });\n        const accessToken = response.data.access_token;\n        await getUserInfo(accessToken);\n      } catch (error) {\n        console.error(\"Failed to exchange authorization code for access token:\", error);\n      }\n    };\n    const getUserInfo = async accessToken => {\n      try {\n        const response = await axios.get(\"https://www.googleapis.com/oauth2/v1/userinfo?alt=json\", {\n          headers: {\n            Authorization: `Bearer ${accessToken}`\n          }\n        });\n        const userInfo = response.data;\n        console.log(\"User Info:\", userInfo);\n\n        // Call the oauth action with the user info\n        const registerUser = {\n          firstname: userInfo.given_name,\n          lastname: userInfo.family_name,\n          show_name: userInfo.given_name,\n          email: userInfo.email,\n          password: \"N/A\"\n        };\n        await store.dispatch(\"auth/oauth\", registerUser);\n        router.push(\"/dashboard\");\n      } catch (error) {\n        console.error(\"Failed to fetch user info:\", error);\n      }\n    };\n    onMounted(() => {\n      const code = new URL(window.location.href).searchParams.get(\"code\");\n      const state = new URL(window.location.href).searchParams.get(\"state\");\n      if (code && state) {\n        getAccessToken(code);\n      } else {\n        console.error(\"Authorization code or state missing.\");\n      }\n    });\n    return {\n      email\n    };\n  }\n};","map":{"version":3,"names":["axios","onMounted","ref","useRouter","useStore","setup","email","router","store","getAccessToken","code","response","post","client_id","client_secret","redirect_uri","grant_type","accessToken","data","access_token","getUserInfo","error","console","get","headers","Authorization","userInfo","log","registerUser","firstname","given_name","lastname","family_name","show_name","password","dispatch","push","URL","window","location","href","searchParams","state"],"sources":["/Users/shane/Desktop/isc project/frontend/web-pos 3.0/src/views/auth/RedirectView.vue"],"sourcesContent":["<template>\n  <h1>Redirecting....</h1>\n</template>\n\n<script>\nimport axios from \"axios\";\nimport { onMounted, ref } from \"vue\";\nimport { useRouter } from \"vue-router\";\nimport { useStore } from \"vuex\";\n\nexport default {\n  setup() {\n    const email = ref(\"\");\n    const router = useRouter();\n    const store = useStore();\n\n    const getAccessToken = async (code) => {\n      try {\n        const response = await axios.post(\"https://oauth2.googleapis.com/token\", {\n          code: code,\n          client_id: \"38181892421-dcmv3r9nvnkbalt85nskg16qtlc8e7n5.apps.googleusercontent.com\",\n          client_secret: \"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\",\n          redirect_uri: \"http://localhost:8020/redirect\",\n          grant_type: \"authorization_code\",\n        });\n\n        const accessToken = response.data.access_token;\n        await getUserInfo(accessToken);\n      } catch (error) {\n        console.error(\"Failed to exchange authorization code for access token:\", error);\n      }\n    };\n\n    const getUserInfo = async (accessToken) => {\n      try {\n        const response = await axios.get(\"https://www.googleapis.com/oauth2/v1/userinfo?alt=json\", {\n          headers: {\n            Authorization: `Bearer ${accessToken}`,\n          },\n        });\n\n        const userInfo = response.data;\n        console.log(\"User Info:\", userInfo);\n\n        // Call the oauth action with the user info\n        const registerUser = {\n          firstname: userInfo.given_name,\n          lastname: userInfo.family_name,\n          show_name: userInfo.given_name,\n          email: userInfo.email,\n          password: \"N/A\",\n        };\n        await store.dispatch(\"auth/oauth\", registerUser);\n\n        router.push(\"/dashboard\");\n      } catch (error) {\n        console.error(\"Failed to fetch user info:\", error);\n      }\n    };\n\n    onMounted(() => {\n      const code = new URL(window.location.href).searchParams.get(\"code\");\n      const state = new URL(window.location.href).searchParams.get(\"state\");\n\n      if (code && state) {\n        getAccessToken(code);\n      } else {\n        console.error(\"Authorization code or state missing.\");\n      }\n    });\n\n    return { email };\n  },\n};\n</script>\n\n<style></style>\n"],"mappings":"AAKA,OAAOA,KAAI,MAAO,OAAO;AACzB,SAASC,SAAS,EAAEC,GAAE,QAAS,KAAK;AACpC,SAASC,SAAQ,QAAS,YAAY;AACtC,SAASC,QAAO,QAAS,MAAM;AAE/B,eAAe;EACbC,KAAKA,CAAA,EAAG;IACN,MAAMC,KAAI,GAAIJ,GAAG,CAAC,EAAE,CAAC;IACrB,MAAMK,MAAK,GAAIJ,SAAS,CAAC,CAAC;IAC1B,MAAMK,KAAI,GAAIJ,QAAQ,CAAC,CAAC;IAExB,MAAMK,cAAa,GAAI,MAAOC,IAAI,IAAK;MACrC,IAAI;QACF,MAAMC,QAAO,GAAI,MAAMX,KAAK,CAACY,IAAI,CAAC,qCAAqC,EAAE;UACvEF,IAAI,EAAEA,IAAI;UACVG,SAAS,EAAE,yEAAyE;UACpFC,aAAa,EAAE,qCAAqC;UACpDC,YAAY,EAAE,gCAAgC;UAC9CC,UAAU,EAAE;QACd,CAAC,CAAC;QAEF,MAAMC,WAAU,GAAIN,QAAQ,CAACO,IAAI,CAACC,YAAY;QAC9C,MAAMC,WAAW,CAACH,WAAW,CAAC;MAChC,EAAE,OAAOI,KAAK,EAAE;QACdC,OAAO,CAACD,KAAK,CAAC,yDAAyD,EAAEA,KAAK,CAAC;MACjF;IACF,CAAC;IAED,MAAMD,WAAU,GAAI,MAAOH,WAAW,IAAK;MACzC,IAAI;QACF,MAAMN,QAAO,GAAI,MAAMX,KAAK,CAACuB,GAAG,CAAC,wDAAwD,EAAE;UACzFC,OAAO,EAAE;YACPC,aAAa,EAAE,UAAUR,WAAW;UACtC;QACF,CAAC,CAAC;QAEF,MAAMS,QAAO,GAAIf,QAAQ,CAACO,IAAI;QAC9BI,OAAO,CAACK,GAAG,CAAC,YAAY,EAAED,QAAQ,CAAC;;QAEnC;QACA,MAAME,YAAW,GAAI;UACnBC,SAAS,EAAEH,QAAQ,CAACI,UAAU;UAC9BC,QAAQ,EAAEL,QAAQ,CAACM,WAAW;UAC9BC,SAAS,EAAEP,QAAQ,CAACI,UAAU;UAC9BxB,KAAK,EAAEoB,QAAQ,CAACpB,KAAK;UACrB4B,QAAQ,EAAE;QACZ,CAAC;QACD,MAAM1B,KAAK,CAAC2B,QAAQ,CAAC,YAAY,EAAEP,YAAY,CAAC;QAEhDrB,MAAM,CAAC6B,IAAI,CAAC,YAAY,CAAC;MAC3B,EAAE,OAAOf,KAAK,EAAE;QACdC,OAAO,CAACD,KAAK,CAAC,4BAA4B,EAAEA,KAAK,CAAC;MACpD;IACF,CAAC;IAEDpB,SAAS,CAAC,MAAM;MACd,MAAMS,IAAG,GAAI,IAAI2B,GAAG,CAACC,MAAM,CAACC,QAAQ,CAACC,IAAI,CAAC,CAACC,YAAY,CAAClB,GAAG,CAAC,MAAM,CAAC;MACnE,MAAMmB,KAAI,GAAI,IAAIL,GAAG,CAACC,MAAM,CAACC,QAAQ,CAACC,IAAI,CAAC,CAACC,YAAY,CAAClB,GAAG,CAAC,OAAO,CAAC;MAErE,IAAIb,IAAG,IAAKgC,KAAK,EAAE;QACjBjC,cAAc,CAACC,IAAI,CAAC;MACtB,OAAO;QACLY,OAAO,CAACD,KAAK,CAAC,sCAAsC,CAAC;MACvD;IACF,CAAC,CAAC;IAEF,OAAO;MAAEf;IAAM,CAAC;EAClB;AACF,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}